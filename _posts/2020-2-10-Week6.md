---
layout: post
title: Week 6
---

# Security Misconfiguration
Security misconfiguration is commonly a result of insecure default configurations, incomplete or ad hoc configurations, open cloud storage, misconfigured HTTP headers, and verbose error messages containing sensitive information. Not only must all operating systems, frameworks, libraries, and applications be securely configured, but they must be patched/upgraded in a timely fashion.<sup>[1]</sup>

### Exercise
For this excercise we will be downloading OWASP ZAP, an open source penetration testing tool. Download the appropriate installer from ZAP’s download location at https://www.zaproxy.org/download/ and execute the installer.

### DISCLAIMER:    
> You should only use ZAP to attack an application you have permission to test with an active attack. Because this is a simulation that acts like a real attack, actual damage can be done to a site’s functionality, data, etc. If you are worried about using ZAP, you can prevent it from causing harm (though ZAP’s functionality will be significantly reduced) by switching to safe mode.     
> To switch ZAP to safe mode, click the arrow on the mode dropdown on the main toolbar to expand the dropdown list and select Safe Mode.<sup>[2]</sup>

1. After installing, click on the ZAP icon and select No I do not want to persist this session at this moment in time, then click Start.

   ![ZAP Start](/images/Start.JPG)

2. On the welcome scren you will see three options, click on the Automated Scan. 

   ![ZAP Welcome](/images/Welcome.JPG)
   
3. Enter the following information before clicking on attack button: 
    - URL to attack: https://sbr2020.herokuapp.com
    - Use traditional spider: check 
    - Use AJAX spider: uncheck   

ZAP will proceed to crawl the web application with its spider and passively scan each page it finds. Then ZAP will use the active    scanner to attack all of the discovered pages,functionality, and parameters.    

   ![Zap Automated Scan](/images/Scan.JPG) 
    
 4. After the scan is complete go to the Alerts tab and click on each alert to read about each vulnerability. 
 
    **X-Frame-Options Header Not Set**    
    As you can see this is a Medium risk alert and the additional information provided shows the Description of the issue explaining why this makes the web app vulnerable and to which kind of attacks, a Solution and a Reference page.   
    
    ![Zap Alert 1](/images/Xframe.JPG) 
    
    **Absence of Anti-CSRF Tokens** 
    
    ![Zap Alert 2](/images/Tokens.JPG) 
    
    **Cookie without SameSite Attribute**  
    
    ZAP highlights the piece of code and/or part of the request that has an issue. This along with the solution and Reference windows makes it easier to find a solution for each vulnerability.    
    
    ![Zap Alert 3](/images/cookie.JPG)
    
    **Cookie without secure flag**  
    
    ![Zap Alert 4](/images/encrypt.JPG)
    
    **Cross-Domain Javascript Source File Inclusion**  
    
    ![Zap Alert 5](/images/crossDomain.JPG)
    
    **Incomplete or No Cache-control and Pragma HTTP Header Set**  
    
    ![Zap Alert 6](/images/no-Cache.JPG)
    
    **Server Leaks Information**  
    
    ![Zap Alert 7](/images/Leak.JPG)
    
    **X-Content-Type-Options Header Missing**  
    
    ![Zap Alert 8](/images/Sniffing.JPG)
    
    **Sensitive Information in URL** 
    
    ![Zap Alert 9](/images/Information.JPG)   


### Analysis

This week's excercise shows the importance of penetration testing and how a simple misconfiguration can lead to a major vulnerability on our site. The highest risk alert was 'X-Frame-Options Header Not Set' and in the description we learned that this makes our website vulnerable to 'ClickJacking' attacks.   
> Clickjacking is an attack that occurs when an attacker uses a transparent iframe in a window to trick a user into clicking on a CTA, such as a button or link, to another server in which they have an identical looking window. The attacker in a sense hijacks the clicks meant for the original server and sends them to the other server. This is an attack on both the visitor themselves and on the server.<sup>[3]</sup>   

**Note**: Showing you how to perform a ClickjJacking attack is out of scope for this project.     

To enable X-Frame-Options or XFO we simply downloaded the npm helmet package (Helmet helps secure Express apps by setting various HTTP headers)  and added the following line of code in our app.js file.    
> app.use(helmet.frameguard())

After enabling XFO we run the Automated Scan on our secure website, notice no X-Frame-Options alert this time.

   ![Zap Secure](/images/Hardened.JPG)   

### References
1. https://owasp.org/www-project-top-ten/  
2. https://www.zaproxy.org/pdf/ZAPGettingStartedGuide-2.9.pdf
3. https://www.keycdn.com/blog/x-frame-options
